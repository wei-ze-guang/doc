| 类/接口                        | 继承关系           | 底层数据结构         | 线程安全 | 线程安全实现方式                         | 是否保证顺序      | 备注                              |
| --------------------------- | -------------- | -------------- | ---- | -------------------------------- | ----------- | ------------------------------- |
| **Map\<K,V>**               | —              | —              | —    | —                                | —           | 顶层接口                            |
| **AbstractMap\<K,V>**       | 实现 Map         | —              | —    | —                                | —           | 部分默认实现                          |
| **HashMap\<K,V>**           | 继承 AbstractMap | 数组 + 链表 + 红黑树  | 否    | —                                | 否           | 允许 `null` 键和值                   |
| **LinkedHashMap\<K,V>**     | 继承 HashMap     | HashMap + 双向链表 | 否    | —                                | 保证插入顺序或访问顺序 | 维护插入顺序或访问顺序                     |
| **TreeMap\<K,V>**           | 继承 AbstractMap | 红黑树            | 否    | —                                | 键的排序顺序      | 键必须实现 Comparable 或传入 Comparator |
| **Hashtable\<K,V>**         | 实现 Map         | 数组 + 链表        | 是    | 所有公共方法均加 `synchronized` 关键字      | 否           | 不允许 `null` 键和值                  |
| **ConcurrentHashMap\<K,V>** | 实现 Map         | 数组 + 链表 + 红黑树  | 是    | JDK7 分段锁；JDK8 CAS + synchronized | 否           | 高效线程安全实现，不允许 `null` 键和值         |
---  
ConcurrentHashMap 的线程安全原理概述
ConcurrentHashMap 通过**分段锁（JDK7）/无锁+CAS（JDK8及以后）**的设计，实现了高效的并发访问：
JDK7 之前： 采用分段锁（Segment）机制，对整个 Map 进行分段加锁，减少锁竞争。每个段独立加锁。
JDK8 及以后： 去掉了分段锁，采用了基于 CAS（Compare-And-Swap）操作的无锁机制和部分细粒度锁（如链表树化时锁桶节点）结合的策略。  
1. 读操作（如 get(key)）
   无锁（无阻塞）读取
JDK8+版本中，get 操作不加锁，直接通过 volatile 读数据和 hash 快速定位桶，保证可见性和安全性。
通过 volatile 变量和内存屏障保证读取到的是最新的写入结果。
如果遇到链表或红黑树节点，会遍历对应节点查找匹配项。  
为什么读操作不加锁安全？
因为写入时使用了 volatile 或 CAS 保证数据的可见性。
读取的结构不会被破坏，且对结构的修改都有同步措施。  
---  
## ConcurrentHashMap
| 操作类型      | 线程安全实现机制              | 是否加锁     | 说明         |
| --------- | --------------------- | -------- | ---------- |
| 读 (`get`) | 无锁，使用 volatile + 内存屏障 | 否        | 高效，无阻塞     |
| 写 (`put`) | CAS + 局部锁（链表头或树节点锁）   | 部分桶或节点加锁 | 细粒度锁，减少锁竞争 |
| 删除        | 锁定目标桶或节点              | 是        | 保证结构安全     |
| 修改        | CAS + 局部锁             | 是（部分锁）   | 保证操作原子性    |
| 查询大小      | 统计各分段计数器累加            | 否（非严格准确） | 近似大小，避免全局锁 |
